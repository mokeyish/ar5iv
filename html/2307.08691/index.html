<!DOCTYPE html><html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>FlashAttention-2: Faster Attention with Better Work Scheduling</title>
<!--Generated on Thu Jul 20 01:37:45 2023 by LaTeXML (version 0.8.7) http://dlmf.nist.gov/LaTeXML/.-->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/dginev/ar5iv-css@0.7.6/css/ar5iv.min.css" type="text/css">
</head>
<body>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document">
<h1 class="ltx_title ltx_title_document">
<span id="id1.id1" class="ltx_text ltx_font_smallcaps">FlashAttention-2</span>: Faster Attention with Better Work Scheduling</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Tri Dao
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation">Department of Computer Science, Princeton University
</span></span></span>
</div>

<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Background</h2>

<div id="S1.p1" class="ltx_para">
<p id="S1.p1.1" class="ltx_p">We provide some background on the performance characteristics of common deep
learning operations on modern hardware (GPUs).
We also describe the standard implementation of attention, as well as <span id="S1.p1.1.1" class="ltx_text ltx_font_smallcaps">FlashAttention</span>.</p>
</div>
<section id="S1.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">1.1 </span>Hardware Performance</h3>

<div id="S1.SS1.p1" class="ltx_para">
<p id="S1.SS1.p1.1" class="ltx_p">We focus here on GPUs.
Performance on other hardware accelerators are similar <cite class="ltx_cite ltx_citemacro_citep">[<span class="ltx_ref ltx_missing_citation ltx_ref_self">jouppi2017datacenter</span>, <span class="ltx_ref ltx_missing_citation ltx_ref_self">jia2019dissecting</span>]</cite>.</p>
</div>
<div id="S1.SS1.p2" class="ltx_para">
<p id="S1.SS1.p2.1" class="ltx_p"><span id="S1.SS1.p2.1.1" class="ltx_text ltx_font_bold">GPU Memory Hierarchy.</span>
The GPU memory hierarchy (<span class="ltx_ref ltx_missing_label ltx_ref_self">LABEL:fig:banner</span> left) comprises multiple forms of memory of different
sizes and speeds, with smaller memory being faster.
As an example, the A100 GPU has 40-80GB of high bandwidth memory (HBM) with
bandwidth 1.5-2.0TB/s and 192KB of on-chip SRAM per each of 108 streaming
multiprocessors with
bandwidth estimated around 19TB/s <cite class="ltx_cite ltx_citemacro_citep">[<span class="ltx_ref ltx_missing_citation ltx_ref_self">jia2018dissecting</span>, <span class="ltx_ref ltx_missing_citation ltx_ref_self">jia2021dissecting</span>]</cite>.
The on-chip SRAM is an order of magnitude faster than HBM but many orders of
magnitude smaller in size.
As compute has gotten faster relative to memory speed <cite class="ltx_cite ltx_citemacro_citep">[<span class="ltx_ref ltx_missing_citation ltx_ref_self">nvidia2017nvidia</span>, <span class="ltx_ref ltx_missing_citation ltx_ref_self">nvidia2020nvidia</span>, <span class="ltx_ref ltx_missing_citation ltx_ref_self">nvidia2022nvidia</span>]</cite>, operations
are increasingly bottlenecked by memory (HBM) accesses.
Thus exploiting fast SRAM becomes more important.</p>
</div>
<div id="S1.SS1.p3" class="ltx_para">
<p id="S1.SS1.p3.1" class="ltx_p"><span id="S1.SS1.p3.1.1" class="ltx_text ltx_font_bold">Execution Model.</span>
GPUs have a massive number of threads to execute an operation
(called a kernel).
Each kernel loads inputs from HBM to registers and SRAM, computes, then writes outputs to HBM.</p>
</div>
<div id="S1.SS1.p4" class="ltx_para">
<p id="S1.SS1.p4.1" class="ltx_p"><span id="S1.SS1.p4.1.1" class="ltx_text ltx_font_bold">Performance characteristics.</span> Depending on the balance of computation and memory accesses, operations can be
classified as either compute-bound or memory-bound.
This is commonly measured by the <em id="S1.SS1.p4.1.2" class="ltx_emph ltx_font_italic">arithmetic intensity</em> <cite class="ltx_cite ltx_citemacro_citep">[<span class="ltx_ref ltx_missing_citation ltx_ref_self">williams2009roofline</span>]</cite>,
which is the number of arithmetic operations per byte of memory access.</p>
<ol id="S1.I1" class="ltx_enumerate">
<li id="S1.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span> 
<div id="S1.I1.i1.p1" class="ltx_para">
<p id="S1.I1.i1.p1.1" class="ltx_p">Compute-bound: the time taken by the operation is determined by how many
arithmetic operations there are, while time accessing HBM
is much smaller. Typical examples are matrix multiply with large inner
dimension, and convolution with large number of channels.</p>
</div>
</li>
<li id="S1.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span> 
<div id="S1.I1.i2.p1" class="ltx_para">
<p id="S1.I1.i2.p1.1" class="ltx_p">Memory-bound: the time taken by the operation is determined by the
number of memory accesses, while time spent in computation is much smaller.
Examples include most other operations:
elementwise (e.g., activation, dropout), and reduction (e.g., sum,
softmax, batch norm, layer norm).
</p>
</div>
</li>
</ol>
</div>
<div id="S1.SS1.p5" class="ltx_para">
<p id="S1.SS1.p5.1" class="ltx_p"><span id="S1.SS1.p5.1.1" class="ltx_text ltx_font_bold">Kernel fusion.</span>
The most common approach to accelerate memory-bound operations is
kernel fusion: if there are multiple operations applied to the same input,
the input can be loaded once from HBM, instead of multiple times for each operation.
Compilers can automatically fuse many elementwise operations <cite class="ltx_cite ltx_citemacro_citep">[<span class="ltx_ref ltx_missing_citation ltx_ref_self">li2020deep</span>, <span class="ltx_ref ltx_missing_citation ltx_ref_self">paszke2019pytorch</span>, <span class="ltx_ref ltx_missing_citation ltx_ref_self">sabne2020xla</span>]</cite>.
However, in the context of model training, the intermediate values still need
to be written to HBM to save for the backward pass, reducing the
effectiveness of naive kernel fusion.</p>
</div>
</section>
<section id="S1.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">1.2 </span>Standard Attention Implementation</h3>

<div id="S1.SS2.p1" class="ltx_para">
<p id="S1.SS2.p1.4" class="ltx_p">Given input sequences <math id="S1.SS2.p1.1.m1.3" class="ltx_Math" alttext="\mathbf{Q},\mathbf{K},\mathbf{V}\in\mathbb{R}^{N\times d}" display="inline"><semantics id="S1.SS2.p1.1.m1.3a"><mrow id="S1.SS2.p1.1.m1.3.4" xref="S1.SS2.p1.1.m1.3.4.cmml"><mrow id="S1.SS2.p1.1.m1.3.4.2.2" xref="S1.SS2.p1.1.m1.3.4.2.1.cmml"><mi id="S1.SS2.p1.1.m1.1.1" xref="S1.SS2.p1.1.m1.1.1.cmml">𝐐</mi><mo id="S1.SS2.p1.1.m1.3.4.2.2.1" xref="S1.SS2.p1.1.m1.3.4.2.1.cmml">,</mo><mi id="S1.SS2.p1.1.m1.2.2" xref="S1.SS2.p1.1.m1.2.2.cmml">𝐊</mi><mo id="S1.SS2.p1.1.m1.3.4.2.2.2" xref="S1.SS2.p1.1.m1.3.4.2.1.cmml">,</mo><mi id="S1.SS2.p1.1.m1.3.3" xref="S1.SS2.p1.1.m1.3.3.cmml">𝐕</mi></mrow><mo id="S1.SS2.p1.1.m1.3.4.1" xref="S1.SS2.p1.1.m1.3.4.1.cmml">∈</mo><msup id="S1.SS2.p1.1.m1.3.4.3" xref="S1.SS2.p1.1.m1.3.4.3.cmml"><mi id="S1.SS2.p1.1.m1.3.4.3.2" xref="S1.SS2.p1.1.m1.3.4.3.2.cmml">ℝ</mi><mrow id="S1.SS2.p1.1.m1.3.4.3.3" xref="S1.SS2.p1.1.m1.3.4.3.3.cmml"><mi id="S1.SS2.p1.1.m1.3.4.3.3.2" xref="S1.SS2.p1.1.m1.3.4.3.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S1.SS2.p1.1.m1.3.4.3.3.1" xref="S1.SS2.p1.1.m1.3.4.3.3.1.cmml">×</mo><mi id="S1.SS2.p1.1.m1.3.4.3.3.3" xref="S1.SS2.p1.1.m1.3.4.3.3.3.cmml">d</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S1.SS2.p1.1.m1.3b"><apply id="S1.SS2.p1.1.m1.3.4.cmml" xref="S1.SS2.p1.1.m1.3.4"><in id="S1.SS2.p1.1.m1.3.4.1.cmml" xref="S1.SS2.p1.1.m1.3.4.1"></in><list id="S1.SS2.p1.1.m1.3.4.2.1.cmml" xref="S1.SS2.p1.1.m1.3.4.2.2"><ci id="S1.SS2.p1.1.m1.1.1.cmml" xref="S1.SS2.p1.1.m1.1.1">𝐐</ci><ci id="S1.SS2.p1.1.m1.2.2.cmml" xref="S1.SS2.p1.1.m1.2.2">𝐊</ci><ci id="S1.SS2.p1.1.m1.3.3.cmml" xref="S1.SS2.p1.1.m1.3.3">𝐕</ci></list><apply id="S1.SS2.p1.1.m1.3.4.3.cmml" xref="S1.SS2.p1.1.m1.3.4.3"><csymbol cd="ambiguous" id="S1.SS2.p1.1.m1.3.4.3.1.cmml" xref="S1.SS2.p1.1.m1.3.4.3">superscript</csymbol><ci id="S1.SS2.p1.1.m1.3.4.3.2.cmml" xref="S1.SS2.p1.1.m1.3.4.3.2">ℝ</ci><apply id="S1.SS2.p1.1.m1.3.4.3.3.cmml" xref="S1.SS2.p1.1.m1.3.4.3.3"><times id="S1.SS2.p1.1.m1.3.4.3.3.1.cmml" xref="S1.SS2.p1.1.m1.3.4.3.3.1"></times><ci id="S1.SS2.p1.1.m1.3.4.3.3.2.cmml" xref="S1.SS2.p1.1.m1.3.4.3.3.2">𝑁</ci><ci id="S1.SS2.p1.1.m1.3.4.3.3.3.cmml" xref="S1.SS2.p1.1.m1.3.4.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p1.1.m1.3c">\mathbf{Q},\mathbf{K},\mathbf{V}\in\mathbb{R}^{N\times d}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p1.1.m1.3d">bold_Q , bold_K , bold_V ∈ blackboard_R start_POSTSUPERSCRIPT italic_N × italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> where <math id="S1.SS2.p1.2.m2.1" class="ltx_Math" alttext="N" display="inline"><semantics id="S1.SS2.p1.2.m2.1a"><mi id="S1.SS2.p1.2.m2.1.1" xref="S1.SS2.p1.2.m2.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p1.2.m2.1b"><ci id="S1.SS2.p1.2.m2.1.1.cmml" xref="S1.SS2.p1.2.m2.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p1.2.m2.1c">N</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p1.2.m2.1d">italic_N</annotation></semantics></math> is the sequence length and
<math id="S1.SS2.p1.3.m3.1" class="ltx_Math" alttext="d" display="inline"><semantics id="S1.SS2.p1.3.m3.1a"><mi id="S1.SS2.p1.3.m3.1.1" xref="S1.SS2.p1.3.m3.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p1.3.m3.1b"><ci id="S1.SS2.p1.3.m3.1.1.cmml" xref="S1.SS2.p1.3.m3.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p1.3.m3.1c">d</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p1.3.m3.1d">italic_d</annotation></semantics></math> is the head dimension, we want to compute the attention output <math id="S1.SS2.p1.4.m4.1" class="ltx_Math" alttext="\mathbf{O}\in\mathbb{R}^{N\times d}" display="inline"><semantics id="S1.SS2.p1.4.m4.1a"><mrow id="S1.SS2.p1.4.m4.1.1" xref="S1.SS2.p1.4.m4.1.1.cmml"><mi id="S1.SS2.p1.4.m4.1.1.2" xref="S1.SS2.p1.4.m4.1.1.2.cmml">𝐎</mi><mo id="S1.SS2.p1.4.m4.1.1.1" xref="S1.SS2.p1.4.m4.1.1.1.cmml">∈</mo><msup id="S1.SS2.p1.4.m4.1.1.3" xref="S1.SS2.p1.4.m4.1.1.3.cmml"><mi id="S1.SS2.p1.4.m4.1.1.3.2" xref="S1.SS2.p1.4.m4.1.1.3.2.cmml">ℝ</mi><mrow id="S1.SS2.p1.4.m4.1.1.3.3" xref="S1.SS2.p1.4.m4.1.1.3.3.cmml"><mi id="S1.SS2.p1.4.m4.1.1.3.3.2" xref="S1.SS2.p1.4.m4.1.1.3.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S1.SS2.p1.4.m4.1.1.3.3.1" xref="S1.SS2.p1.4.m4.1.1.3.3.1.cmml">×</mo><mi id="S1.SS2.p1.4.m4.1.1.3.3.3" xref="S1.SS2.p1.4.m4.1.1.3.3.3.cmml">d</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S1.SS2.p1.4.m4.1b"><apply id="S1.SS2.p1.4.m4.1.1.cmml" xref="S1.SS2.p1.4.m4.1.1"><in id="S1.SS2.p1.4.m4.1.1.1.cmml" xref="S1.SS2.p1.4.m4.1.1.1"></in><ci id="S1.SS2.p1.4.m4.1.1.2.cmml" xref="S1.SS2.p1.4.m4.1.1.2">𝐎</ci><apply id="S1.SS2.p1.4.m4.1.1.3.cmml" xref="S1.SS2.p1.4.m4.1.1.3"><csymbol cd="ambiguous" id="S1.SS2.p1.4.m4.1.1.3.1.cmml" xref="S1.SS2.p1.4.m4.1.1.3">superscript</csymbol><ci id="S1.SS2.p1.4.m4.1.1.3.2.cmml" xref="S1.SS2.p1.4.m4.1.1.3.2">ℝ</ci><apply id="S1.SS2.p1.4.m4.1.1.3.3.cmml" xref="S1.SS2.p1.4.m4.1.1.3.3"><times id="S1.SS2.p1.4.m4.1.1.3.3.1.cmml" xref="S1.SS2.p1.4.m4.1.1.3.3.1"></times><ci id="S1.SS2.p1.4.m4.1.1.3.3.2.cmml" xref="S1.SS2.p1.4.m4.1.1.3.3.2">𝑁</ci><ci id="S1.SS2.p1.4.m4.1.1.3.3.3.cmml" xref="S1.SS2.p1.4.m4.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p1.4.m4.1c">\mathbf{O}\in\mathbb{R}^{N\times d}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p1.4.m4.1d">bold_O ∈ blackboard_R start_POSTSUPERSCRIPT italic_N × italic_d end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table id="S1.Ex1" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S1.Ex1.m1.2" class="ltx_Math" alttext="\mathbf{S}=\mathbf{Q}\mathbf{K}^{\top}\in\mathbb{R}^{N\times N},\quad\mathbf{P}=\mathrm{softmax}(\mathbf{S})\in\mathbb{R}^{N\times N},\quad\mathbf{O}=\mathbf{P}\mathbf{V}\in\mathbb{R}^{N\times d}," display="block"><semantics id="S1.Ex1.m1.2a"><mrow id="S1.Ex1.m1.2.2.1"><mrow id="S1.Ex1.m1.2.2.1.1.3" xref="S1.Ex1.m1.2.2.1.1.4.cmml"><mrow id="S1.Ex1.m1.2.2.1.1.1.1" xref="S1.Ex1.m1.2.2.1.1.1.1.cmml"><mi id="S1.Ex1.m1.2.2.1.1.1.1.2" xref="S1.Ex1.m1.2.2.1.1.1.1.2.cmml">𝐒</mi><mo id="S1.Ex1.m1.2.2.1.1.1.1.3" xref="S1.Ex1.m1.2.2.1.1.1.1.3.cmml">=</mo><msup id="S1.Ex1.m1.2.2.1.1.1.1.4" xref="S1.Ex1.m1.2.2.1.1.1.1.4.cmml"><mi id="S1.Ex1.m1.2.2.1.1.1.1.4.2" xref="S1.Ex1.m1.2.2.1.1.1.1.4.2.cmml">𝐐𝐊</mi><mo id="S1.Ex1.m1.2.2.1.1.1.1.4.3" xref="S1.Ex1.m1.2.2.1.1.1.1.4.3.cmml">⊤</mo></msup><mo id="S1.Ex1.m1.2.2.1.1.1.1.5" xref="S1.Ex1.m1.2.2.1.1.1.1.5.cmml">∈</mo><msup id="S1.Ex1.m1.2.2.1.1.1.1.6" xref="S1.Ex1.m1.2.2.1.1.1.1.6.cmml"><mi id="S1.Ex1.m1.2.2.1.1.1.1.6.2" xref="S1.Ex1.m1.2.2.1.1.1.1.6.2.cmml">ℝ</mi><mrow id="S1.Ex1.m1.2.2.1.1.1.1.6.3" xref="S1.Ex1.m1.2.2.1.1.1.1.6.3.cmml"><mi id="S1.Ex1.m1.2.2.1.1.1.1.6.3.2" xref="S1.Ex1.m1.2.2.1.1.1.1.6.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S1.Ex1.m1.2.2.1.1.1.1.6.3.1" xref="S1.Ex1.m1.2.2.1.1.1.1.6.3.1.cmml">×</mo><mi id="S1.Ex1.m1.2.2.1.1.1.1.6.3.3" xref="S1.Ex1.m1.2.2.1.1.1.1.6.3.3.cmml">N</mi></mrow></msup></mrow><mo rspace="1.167em" id="S1.Ex1.m1.2.2.1.1.3.4" xref="S1.Ex1.m1.2.2.1.1.4a.cmml">,</mo><mrow id="S1.Ex1.m1.2.2.1.1.2.2" xref="S1.Ex1.m1.2.2.1.1.2.2.cmml"><mi id="S1.Ex1.m1.2.2.1.1.2.2.2" xref="S1.Ex1.m1.2.2.1.1.2.2.2.cmml">𝐏</mi><mo id="S1.Ex1.m1.2.2.1.1.2.2.3" xref="S1.Ex1.m1.2.2.1.1.2.2.3.cmml">=</mo><mrow id="S1.Ex1.m1.2.2.1.1.2.2.4" xref="S1.Ex1.m1.2.2.1.1.2.2.4.cmml"><mi id="S1.Ex1.m1.2.2.1.1.2.2.4.2" xref="S1.Ex1.m1.2.2.1.1.2.2.4.2.cmml">softmax</mi><mo id="S1.Ex1.m1.2.2.1.1.2.2.4.1" xref="S1.Ex1.m1.2.2.1.1.2.2.4.1.cmml">⁢</mo><mrow id="S1.Ex1.m1.2.2.1.1.2.2.4.3.2" xref="S1.Ex1.m1.2.2.1.1.2.2.4.cmml"><mo stretchy="false" id="S1.Ex1.m1.2.2.1.1.2.2.4.3.2.1" xref="S1.Ex1.m1.2.2.1.1.2.2.4.cmml">(</mo><mi id="S1.Ex1.m1.1.1" xref="S1.Ex1.m1.1.1.cmml">𝐒</mi><mo stretchy="false" id="S1.Ex1.m1.2.2.1.1.2.2.4.3.2.2" xref="S1.Ex1.m1.2.2.1.1.2.2.4.cmml">)</mo></mrow></mrow><mo id="S1.Ex1.m1.2.2.1.1.2.2.5" xref="S1.Ex1.m1.2.2.1.1.2.2.5.cmml">∈</mo><msup id="S1.Ex1.m1.2.2.1.1.2.2.6" xref="S1.Ex1.m1.2.2.1.1.2.2.6.cmml"><mi id="S1.Ex1.m1.2.2.1.1.2.2.6.2" xref="S1.Ex1.m1.2.2.1.1.2.2.6.2.cmml">ℝ</mi><mrow id="S1.Ex1.m1.2.2.1.1.2.2.6.3" xref="S1.Ex1.m1.2.2.1.1.2.2.6.3.cmml"><mi id="S1.Ex1.m1.2.2.1.1.2.2.6.3.2" xref="S1.Ex1.m1.2.2.1.1.2.2.6.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S1.Ex1.m1.2.2.1.1.2.2.6.3.1" xref="S1.Ex1.m1.2.2.1.1.2.2.6.3.1.cmml">×</mo><mi id="S1.Ex1.m1.2.2.1.1.2.2.6.3.3" xref="S1.Ex1.m1.2.2.1.1.2.2.6.3.3.cmml">N</mi></mrow></msup></mrow><mo rspace="1.167em" id="S1.Ex1.m1.2.2.1.1.3.5" xref="S1.Ex1.m1.2.2.1.1.4a.cmml">,</mo><mrow id="S1.Ex1.m1.2.2.1.1.3.3" xref="S1.Ex1.m1.2.2.1.1.3.3.cmml"><mi id="S1.Ex1.m1.2.2.1.1.3.3.2" xref="S1.Ex1.m1.2.2.1.1.3.3.2.cmml">𝐎</mi><mo id="S1.Ex1.m1.2.2.1.1.3.3.3" xref="S1.Ex1.m1.2.2.1.1.3.3.3.cmml">=</mo><mi id="S1.Ex1.m1.2.2.1.1.3.3.4" xref="S1.Ex1.m1.2.2.1.1.3.3.4.cmml">𝐏𝐕</mi><mo id="S1.Ex1.m1.2.2.1.1.3.3.5" xref="S1.Ex1.m1.2.2.1.1.3.3.5.cmml">∈</mo><msup id="S1.Ex1.m1.2.2.1.1.3.3.6" xref="S1.Ex1.m1.2.2.1.1.3.3.6.cmml"><mi id="S1.Ex1.m1.2.2.1.1.3.3.6.2" xref="S1.Ex1.m1.2.2.1.1.3.3.6.2.cmml">ℝ</mi><mrow id="S1.Ex1.m1.2.2.1.1.3.3.6.3" xref="S1.Ex1.m1.2.2.1.1.3.3.6.3.cmml"><mi id="S1.Ex1.m1.2.2.1.1.3.3.6.3.2" xref="S1.Ex1.m1.2.2.1.1.3.3.6.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S1.Ex1.m1.2.2.1.1.3.3.6.3.1" xref="S1.Ex1.m1.2.2.1.1.3.3.6.3.1.cmml">×</mo><mi id="S1.Ex1.m1.2.2.1.1.3.3.6.3.3" xref="S1.Ex1.m1.2.2.1.1.3.3.6.3.3.cmml">d</mi></mrow></msup></mrow></mrow><mo id="S1.Ex1.m1.2.2.1.2">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S1.Ex1.m1.2b"><apply id="S1.Ex1.m1.2.2.1.1.4.cmml" xref="S1.Ex1.m1.2.2.1.1.3"><csymbol cd="ambiguous" id="S1.Ex1.m1.2.2.1.1.4a.cmml" xref="S1.Ex1.m1.2.2.1.1.3.4">formulae-sequence</csymbol><apply id="S1.Ex1.m1.2.2.1.1.1.1.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1"><and id="S1.Ex1.m1.2.2.1.1.1.1a.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1"></and><apply id="S1.Ex1.m1.2.2.1.1.1.1b.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1"><eq id="S1.Ex1.m1.2.2.1.1.1.1.3.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.3"></eq><ci id="S1.Ex1.m1.2.2.1.1.1.1.2.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.2">𝐒</ci><apply id="S1.Ex1.m1.2.2.1.1.1.1.4.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.4"><csymbol cd="ambiguous" id="S1.Ex1.m1.2.2.1.1.1.1.4.1.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.4">superscript</csymbol><ci id="S1.Ex1.m1.2.2.1.1.1.1.4.2.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.4.2">𝐐𝐊</ci><csymbol cd="latexml" id="S1.Ex1.m1.2.2.1.1.1.1.4.3.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.4.3">top</csymbol></apply></apply><apply id="S1.Ex1.m1.2.2.1.1.1.1c.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1"><in id="S1.Ex1.m1.2.2.1.1.1.1.5.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.5"></in><share href="#S1.Ex1.m1.2.2.1.1.1.1.4.cmml" id="S1.Ex1.m1.2.2.1.1.1.1d.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1"></share><apply id="S1.Ex1.m1.2.2.1.1.1.1.6.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.6"><csymbol cd="ambiguous" id="S1.Ex1.m1.2.2.1.1.1.1.6.1.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.6">superscript</csymbol><ci id="S1.Ex1.m1.2.2.1.1.1.1.6.2.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.6.2">ℝ</ci><apply id="S1.Ex1.m1.2.2.1.1.1.1.6.3.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.6.3"><times id="S1.Ex1.m1.2.2.1.1.1.1.6.3.1.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.6.3.1"></times><ci id="S1.Ex1.m1.2.2.1.1.1.1.6.3.2.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.6.3.2">𝑁</ci><ci id="S1.Ex1.m1.2.2.1.1.1.1.6.3.3.cmml" xref="S1.Ex1.m1.2.2.1.1.1.1.6.3.3">𝑁</ci></apply></apply></apply></apply><apply id="S1.Ex1.m1.2.2.1.1.2.2.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2"><and id="S1.Ex1.m1.2.2.1.1.2.2a.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2"></and><apply id="S1.Ex1.m1.2.2.1.1.2.2b.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2"><eq id="S1.Ex1.m1.2.2.1.1.2.2.3.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.3"></eq><ci id="S1.Ex1.m1.2.2.1.1.2.2.2.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.2">𝐏</ci><apply id="S1.Ex1.m1.2.2.1.1.2.2.4.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.4"><times id="S1.Ex1.m1.2.2.1.1.2.2.4.1.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.4.1"></times><ci id="S1.Ex1.m1.2.2.1.1.2.2.4.2.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.4.2">softmax</ci><ci id="S1.Ex1.m1.1.1.cmml" xref="S1.Ex1.m1.1.1">𝐒</ci></apply></apply><apply id="S1.Ex1.m1.2.2.1.1.2.2c.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2"><in id="S1.Ex1.m1.2.2.1.1.2.2.5.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.5"></in><share href="#S1.Ex1.m1.2.2.1.1.2.2.4.cmml" id="S1.Ex1.m1.2.2.1.1.2.2d.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2"></share><apply id="S1.Ex1.m1.2.2.1.1.2.2.6.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.6"><csymbol cd="ambiguous" id="S1.Ex1.m1.2.2.1.1.2.2.6.1.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.6">superscript</csymbol><ci id="S1.Ex1.m1.2.2.1.1.2.2.6.2.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.6.2">ℝ</ci><apply id="S1.Ex1.m1.2.2.1.1.2.2.6.3.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.6.3"><times id="S1.Ex1.m1.2.2.1.1.2.2.6.3.1.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.6.3.1"></times><ci id="S1.Ex1.m1.2.2.1.1.2.2.6.3.2.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.6.3.2">𝑁</ci><ci id="S1.Ex1.m1.2.2.1.1.2.2.6.3.3.cmml" xref="S1.Ex1.m1.2.2.1.1.2.2.6.3.3">𝑁</ci></apply></apply></apply></apply><apply id="S1.Ex1.m1.2.2.1.1.3.3.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3"><and id="S1.Ex1.m1.2.2.1.1.3.3a.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3"></and><apply id="S1.Ex1.m1.2.2.1.1.3.3b.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3"><eq id="S1.Ex1.m1.2.2.1.1.3.3.3.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.3"></eq><ci id="S1.Ex1.m1.2.2.1.1.3.3.2.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.2">𝐎</ci><ci id="S1.Ex1.m1.2.2.1.1.3.3.4.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.4">𝐏𝐕</ci></apply><apply id="S1.Ex1.m1.2.2.1.1.3.3c.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3"><in id="S1.Ex1.m1.2.2.1.1.3.3.5.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.5"></in><share href="#S1.Ex1.m1.2.2.1.1.3.3.4.cmml" id="S1.Ex1.m1.2.2.1.1.3.3d.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3"></share><apply id="S1.Ex1.m1.2.2.1.1.3.3.6.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.6"><csymbol cd="ambiguous" id="S1.Ex1.m1.2.2.1.1.3.3.6.1.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.6">superscript</csymbol><ci id="S1.Ex1.m1.2.2.1.1.3.3.6.2.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.6.2">ℝ</ci><apply id="S1.Ex1.m1.2.2.1.1.3.3.6.3.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.6.3"><times id="S1.Ex1.m1.2.2.1.1.3.3.6.3.1.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.6.3.1"></times><ci id="S1.Ex1.m1.2.2.1.1.3.3.6.3.2.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.6.3.2">𝑁</ci><ci id="S1.Ex1.m1.2.2.1.1.3.3.6.3.3.cmml" xref="S1.Ex1.m1.2.2.1.1.3.3.6.3.3">𝑑</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.Ex1.m1.2c">\mathbf{S}=\mathbf{Q}\mathbf{K}^{\top}\in\mathbb{R}^{N\times N},\quad\mathbf{P}=\mathrm{softmax}(\mathbf{S})\in\mathbb{R}^{N\times N},\quad\mathbf{O}=\mathbf{P}\mathbf{V}\in\mathbb{R}^{N\times d},</annotation><annotation encoding="application/x-llamapun" id="S1.Ex1.m1.2d">bold_S = bold_QK start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_N × italic_N end_POSTSUPERSCRIPT , bold_P = roman_softmax ( bold_S ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_N × italic_N end_POSTSUPERSCRIPT , bold_O = bold_PV ∈ blackboard_R start_POSTSUPERSCRIPT italic_N × italic_d end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p id="S1.SS2.p1.5" class="ltx_p">where <math id="S1.SS2.p1.5.m1.1" class="ltx_Math" alttext="\mathrm{softmax}" display="inline"><semantics id="S1.SS2.p1.5.m1.1a"><mi id="S1.SS2.p1.5.m1.1.1" xref="S1.SS2.p1.5.m1.1.1.cmml">softmax</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p1.5.m1.1b"><ci id="S1.SS2.p1.5.m1.1.1.cmml" xref="S1.SS2.p1.5.m1.1.1">softmax</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p1.5.m1.1c">\mathrm{softmax}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p1.5.m1.1d">roman_softmax</annotation></semantics></math> is applied row-wise.<span id="footnote1" class="ltx_note ltx_role_footnote"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>For clarity of exposition, we
omit the scaling of <math id="footnote1.m1.1" class="ltx_Math" alttext="\mathbf{Q}\mathbf{K}^{\top}" display="inline"><semantics id="footnote1.m1.1b"><msup id="footnote1.m1.1.1" xref="footnote1.m1.1.1.cmml"><mi id="footnote1.m1.1.1.2" xref="footnote1.m1.1.1.2.cmml">𝐐𝐊</mi><mo id="footnote1.m1.1.1.3" xref="footnote1.m1.1.1.3.cmml">⊤</mo></msup><annotation-xml encoding="MathML-Content" id="footnote1.m1.1c"><apply id="footnote1.m1.1.1.cmml" xref="footnote1.m1.1.1"><csymbol cd="ambiguous" id="footnote1.m1.1.1.1.cmml" xref="footnote1.m1.1.1">superscript</csymbol><ci id="footnote1.m1.1.1.2.cmml" xref="footnote1.m1.1.1.2">𝐐𝐊</ci><csymbol cd="latexml" id="footnote1.m1.1.1.3.cmml" xref="footnote1.m1.1.1.3">top</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="footnote1.m1.1d">\mathbf{Q}\mathbf{K}^{\top}</annotation><annotation encoding="application/x-llamapun" id="footnote1.m1.1e">bold_QK start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT</annotation></semantics></math> (typically by <math id="footnote1.m2.1" class="ltx_Math" alttext="1/\mathrm{d}" display="inline"><semantics id="footnote1.m2.1b"><mrow id="footnote1.m2.1.1" xref="footnote1.m2.1.1.cmml"><mn id="footnote1.m2.1.1.2" xref="footnote1.m2.1.1.2.cmml">1</mn><mo id="footnote1.m2.1.1.1" xref="footnote1.m2.1.1.1.cmml">/</mo><mi mathvariant="normal" id="footnote1.m2.1.1.3" xref="footnote1.m2.1.1.3.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="footnote1.m2.1c"><apply id="footnote1.m2.1.1.cmml" xref="footnote1.m2.1.1"><divide id="footnote1.m2.1.1.1.cmml" xref="footnote1.m2.1.1.1"></divide><cn type="integer" id="footnote1.m2.1.1.2.cmml" xref="footnote1.m2.1.1.2">1</cn><ci id="footnote1.m2.1.1.3.cmml" xref="footnote1.m2.1.1.3">d</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="footnote1.m2.1d">1/\mathrm{d}</annotation><annotation encoding="application/x-llamapun" id="footnote1.m2.1e">1 / roman_d</annotation></semantics></math>), and optionally
elementwise masking on <math id="footnote1.m3.1" class="ltx_Math" alttext="\mathbf{S}" display="inline"><semantics id="footnote1.m3.1b"><mi id="footnote1.m3.1.1" xref="footnote1.m3.1.1.cmml">𝐒</mi><annotation-xml encoding="MathML-Content" id="footnote1.m3.1c"><ci id="footnote1.m3.1.1.cmml" xref="footnote1.m3.1.1">𝐒</ci></annotation-xml><annotation encoding="application/x-tex" id="footnote1.m3.1d">\mathbf{S}</annotation><annotation encoding="application/x-llamapun" id="footnote1.m3.1e">bold_S</annotation></semantics></math> and/or dropout applied to <math id="footnote1.m4.1" class="ltx_Math" alttext="\mathbf{P}" display="inline"><semantics id="footnote1.m4.1b"><mi id="footnote1.m4.1.1" xref="footnote1.m4.1.1.cmml">𝐏</mi><annotation-xml encoding="MathML-Content" id="footnote1.m4.1c"><ci id="footnote1.m4.1.1.cmml" xref="footnote1.m4.1.1">𝐏</ci></annotation-xml><annotation encoding="application/x-tex" id="footnote1.m4.1d">\mathbf{P}</annotation><annotation encoding="application/x-llamapun" id="footnote1.m4.1e">bold_P</annotation></semantics></math></span></span></span> For multi-head
attention (MHA), this same computation is performed in parallel across many
heads, and parallel over the batch dimension (number of input sequences in a
batch).</p>
</div>
<div id="S1.SS2.p2" class="ltx_para">
<p id="S1.SS2.p2.2" class="ltx_p">The backward pass of attention proceeds as follows.
Let <math id="S1.SS2.p2.1.m1.1" class="ltx_Math" alttext="\mathbf{dO}\in\mathbb{R}^{N\times d}" display="inline"><semantics id="S1.SS2.p2.1.m1.1a"><mrow id="S1.SS2.p2.1.m1.1.1" xref="S1.SS2.p2.1.m1.1.1.cmml"><mi id="S1.SS2.p2.1.m1.1.1.2" xref="S1.SS2.p2.1.m1.1.1.2.cmml">𝐝𝐎</mi><mo id="S1.SS2.p2.1.m1.1.1.1" xref="S1.SS2.p2.1.m1.1.1.1.cmml">∈</mo><msup id="S1.SS2.p2.1.m1.1.1.3" xref="S1.SS2.p2.1.m1.1.1.3.cmml"><mi id="S1.SS2.p2.1.m1.1.1.3.2" xref="S1.SS2.p2.1.m1.1.1.3.2.cmml">ℝ</mi><mrow id="S1.SS2.p2.1.m1.1.1.3.3" xref="S1.SS2.p2.1.m1.1.1.3.3.cmml"><mi id="S1.SS2.p2.1.m1.1.1.3.3.2" xref="S1.SS2.p2.1.m1.1.1.3.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S1.SS2.p2.1.m1.1.1.3.3.1" xref="S1.SS2.p2.1.m1.1.1.3.3.1.cmml">×</mo><mi id="S1.SS2.p2.1.m1.1.1.3.3.3" xref="S1.SS2.p2.1.m1.1.1.3.3.3.cmml">d</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S1.SS2.p2.1.m1.1b"><apply id="S1.SS2.p2.1.m1.1.1.cmml" xref="S1.SS2.p2.1.m1.1.1"><in id="S1.SS2.p2.1.m1.1.1.1.cmml" xref="S1.SS2.p2.1.m1.1.1.1"></in><ci id="S1.SS2.p2.1.m1.1.1.2.cmml" xref="S1.SS2.p2.1.m1.1.1.2">𝐝𝐎</ci><apply id="S1.SS2.p2.1.m1.1.1.3.cmml" xref="S1.SS2.p2.1.m1.1.1.3"><csymbol cd="ambiguous" id="S1.SS2.p2.1.m1.1.1.3.1.cmml" xref="S1.SS2.p2.1.m1.1.1.3">superscript</csymbol><ci id="S1.SS2.p2.1.m1.1.1.3.2.cmml" xref="S1.SS2.p2.1.m1.1.1.3.2">ℝ</ci><apply id="S1.SS2.p2.1.m1.1.1.3.3.cmml" xref="S1.SS2.p2.1.m1.1.1.3.3"><times id="S1.SS2.p2.1.m1.1.1.3.3.1.cmml" xref="S1.SS2.p2.1.m1.1.1.3.3.1"></times><ci id="S1.SS2.p2.1.m1.1.1.3.3.2.cmml" xref="S1.SS2.p2.1.m1.1.1.3.3.2">𝑁</ci><ci id="S1.SS2.p2.1.m1.1.1.3.3.3.cmml" xref="S1.SS2.p2.1.m1.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p2.1.m1.1c">\mathbf{dO}\in\mathbb{R}^{N\times d}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p2.1.m1.1d">bold_dO ∈ blackboard_R start_POSTSUPERSCRIPT italic_N × italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> be the gradient of <math id="S1.SS2.p2.2.m2.1" class="ltx_Math" alttext="\mathbf{O}" display="inline"><semantics id="S1.SS2.p2.2.m2.1a"><mi id="S1.SS2.p2.2.m2.1.1" xref="S1.SS2.p2.2.m2.1.1.cmml">𝐎</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p2.2.m2.1b"><ci id="S1.SS2.p2.2.m2.1.1.cmml" xref="S1.SS2.p2.2.m2.1.1">𝐎</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p2.2.m2.1c">\mathbf{O}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p2.2.m2.1d">bold_O</annotation></semantics></math> with respect to some loss
function. Then by the chain rule (aka backpropagation):</p>
<table id="S1.EGx1" class="ltx_equationgroup ltx_eqn_align ltx_eqn_table">

<tbody id="S1.Ex2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math id="S1.Ex2.m1.1" class="ltx_Math" alttext="\displaystyle\mathbf{dV}" display="inline"><semantics id="S1.Ex2.m1.1a"><mi id="S1.Ex2.m1.1.1" xref="S1.Ex2.m1.1.1.cmml">𝐝𝐕</mi><annotation-xml encoding="MathML-Content" id="S1.Ex2.m1.1b"><ci id="S1.Ex2.m1.1.1.cmml" xref="S1.Ex2.m1.1.1">𝐝𝐕</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.Ex2.m1.1c">\displaystyle\mathbf{dV}</annotation><annotation encoding="application/x-llamapun" id="S1.Ex2.m1.1d">bold_dV</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S1.Ex2.m2.1" class="ltx_Math" alttext="\displaystyle=\mathbf{P}^{\top}\mathbf{dO}\in\mathbb{R}^{N\times d}" display="inline"><semantics id="S1.Ex2.m2.1a"><mrow id="S1.Ex2.m2.1.1" xref="S1.Ex2.m2.1.1.cmml"><mi id="S1.Ex2.m2.1.1.2" xref="S1.Ex2.m2.1.1.2.cmml"></mi><mo id="S1.Ex2.m2.1.1.3" xref="S1.Ex2.m2.1.1.3.cmml">=</mo><mrow id="S1.Ex2.m2.1.1.4" xref="S1.Ex2.m2.1.1.4.cmml"><msup id="S1.Ex2.m2.1.1.4.2" xref="S1.Ex2.m2.1.1.4.2.cmml"><mi id="S1.Ex2.m2.1.1.4.2.2" xref="S1.Ex2.m2.1.1.4.2.2.cmml">𝐏</mi><mo id="S1.Ex2.m2.1.1.4.2.3" xref="S1.Ex2.m2.1.1.4.2.3.cmml">⊤</mo></msup><mo id="S1.Ex2.m2.1.1.4.1" xref="S1.Ex2.m2.1.1.4.1.cmml">⁢</mo><mi id="S1.Ex2.m2.1.1.4.3" xref="S1.Ex2.m2.1.1.4.3.cmml">𝐝𝐎</mi></mrow><mo id="S1.Ex2.m2.1.1.5" xref="S1.Ex2.m2.1.1.5.cmml">∈</mo><msup id="S1.Ex2.m2.1.1.6" xref="S1.Ex2.m2.1.1.6.cmml"><mi id="S1.Ex2.m2.1.1.6.2" xref="S1.Ex2.m2.1.1.6.2.cmml">ℝ</mi><mrow id="S1.Ex2.m2.1.1.6.3" xref="S1.Ex2.m2.1.1.6.3.cmml"><mi id="S1.Ex2.m2.1.1.6.3.2" xref="S1.Ex2.m2.1.1.6.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S1.Ex2.m2.1.1.6.3.1" xref="S1.Ex2.m2.1.1.6.3.1.cmml">×</mo><mi id="S1.Ex2.m2.1.1.6.3.3" xref="S1.Ex2.m2.1.1.6.3.3.cmml">d</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S1.Ex2.m2.1b"><apply id="S1.Ex2.m2.1.1.cmml" xref="S1.Ex2.m2.1.1"><and id="S1.Ex2.m2.1.1a.cmml" xref="S1.Ex2.m2.1.1"></and><apply id="S1.Ex2.m2.1.1b.cmml" xref="S1.Ex2.m2.1.1"><eq id="S1.Ex2.m2.1.1.3.cmml" xref="S1.Ex2.m2.1.1.3"></eq><csymbol cd="latexml" id="S1.Ex2.m2.1.1.2.cmml" xref="S1.Ex2.m2.1.1.2">absent</csymbol><apply id="S1.Ex2.m2.1.1.4.cmml" xref="S1.Ex2.m2.1.1.4"><times id="S1.Ex2.m2.1.1.4.1.cmml" xref="S1.Ex2.m2.1.1.4.1"></times><apply id="S1.Ex2.m2.1.1.4.2.cmml" xref="S1.Ex2.m2.1.1.4.2"><csymbol cd="ambiguous" id="S1.Ex2.m2.1.1.4.2.1.cmml" xref="S1.Ex2.m2.1.1.4.2">superscript</csymbol><ci id="S1.Ex2.m2.1.1.4.2.2.cmml" xref="S1.Ex2.m2.1.1.4.2.2">𝐏</ci><csymbol cd="latexml" id="S1.Ex2.m2.1.1.4.2.3.cmml" xref="S1.Ex2.m2.1.1.4.2.3">top</csymbol></apply><ci id="S1.Ex2.m2.1.1.4.3.cmml" xref="S1.Ex2.m2.1.1.4.3">𝐝𝐎</ci></apply></apply><apply id="S1.Ex2.m2.1.1c.cmml" xref="S1.Ex2.m2.1.1"><in id="S1.Ex2.m2.1.1.5.cmml" xref="S1.Ex2.m2.1.1.5"></in><share href="#S1.Ex2.m2.1.1.4.cmml" id="S1.Ex2.m2.1.1d.cmml" xref="S1.Ex2.m2.1.1"></share><apply id="S1.Ex2.m2.1.1.6.cmml" xref="S1.Ex2.m2.1.1.6"><csymbol cd="ambiguous" id="S1.Ex2.m2.1.1.6.1.cmml" xref="S1.Ex2.m2.1.1.6">superscript</csymbol><ci id="S1.Ex2.m2.1.1.6.2.cmml" xref="S1.Ex2.m2.1.1.6.2">ℝ</ci><apply id="S1.Ex2.m2.1.1.6.3.cmml" xref="S1.Ex2.m2.1.1.6.3"><times id="S1.Ex2.m2.1.1.6.3.1.cmml" xref="S1.Ex2.m2.1.1.6.3.1"></times><ci id="S1.Ex2.m2.1.1.6.3.2.cmml" xref="S1.Ex2.m2.1.1.6.3.2">𝑁</ci><ci id="S1.Ex2.m2.1.1.6.3.3.cmml" xref="S1.Ex2.m2.1.1.6.3.3">𝑑</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.Ex2.m2.1c">\displaystyle=\mathbf{P}^{\top}\mathbf{dO}\in\mathbb{R}^{N\times d}</annotation><annotation encoding="application/x-llamapun" id="S1.Ex2.m2.1d">= bold_P start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_dO ∈ blackboard_R start_POSTSUPERSCRIPT italic_N × italic_d end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S1.Ex3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math id="S1.Ex3.m1.1" class="ltx_Math" alttext="\displaystyle\mathbf{dP}" display="inline"><semantics id="S1.Ex3.m1.1a"><mi id="S1.Ex3.m1.1.1" xref="S1.Ex3.m1.1.1.cmml">𝐝𝐏</mi><annotation-xml encoding="MathML-Content" id="S1.Ex3.m1.1b"><ci id="S1.Ex3.m1.1.1.cmml" xref="S1.Ex3.m1.1.1">𝐝𝐏</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.Ex3.m1.1c">\displaystyle\mathbf{dP}</annotation><annotation encoding="application/x-llamapun" id="S1.Ex3.m1.1d">bold_dP</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S1.Ex3.m2.1" class="ltx_Math" alttext="\displaystyle=\mathbf{dO}\mathbf{V}^{\top}\in\mathbb{R}^{N\times N}" display="inline"><semantics id="S1.Ex3.m2.1a"><mrow id="S1.Ex3.m2.1.1" xref="S1.Ex3.m2.1.1.cmml"><mi id="S1.Ex3.m2.1.1.2" xref="S1.Ex3.m2.1.1.2.cmml"></mi><mo id="S1.Ex3.m2.1.1.3" xref="S1.Ex3.m2.1.1.3.cmml">=</mo><msup id="S1.Ex3.m2.1.1.4" xref="S1.Ex3.m2.1.1.4.cmml"><mi id="S1.Ex3.m2.1.1.4.2" xref="S1.Ex3.m2.1.1.4.2.cmml">𝐝𝐎𝐕</mi><mo id="S1.Ex3.m2.1.1.4.3" xref="S1.Ex3.m2.1.1.4.3.cmml">⊤</mo></msup><mo id="S1.Ex3.m2.1.1.5" xref="S1.Ex3.m2.1.1.5.cmml">∈</mo><msup id="S1.Ex3.m2.1.1.6" xref="S1.Ex3.m2.1.1.6.cmml"><mi id="S1.Ex3.m2.1.1.6.2" xref="S1.Ex3.m2.1.1.6.2.cmml">ℝ</mi><mrow id="S1.Ex3.m2.1.1.6.3" xref="S1.Ex3.m2.1.1.6.3.cmml"><mi id="S1.Ex3.m2.1.1.6.3.2" xref="S1.Ex3.m2.1.1.6.3.2.cmml">N</mi><mo lspace="0.222em" rspace="0.222em" id="S1.Ex3.m2.1.1.6.3.1" xref="S1.Ex3.m2.1.1.6.3.1.cmml">×</mo><mi id="S1.Ex3.m2.1.1.6.3.3" xref="S1.Ex3.m2.1.1.6.3.3.cmml">N</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S1.Ex3.m2.1b"><apply id="S1.Ex3.m2.1.1.cmml" xref="S1.Ex3.m2.1.1"><and id="S1.Ex3.m2.1.1a.cmml" xref="S1.Ex3.m2.1.1"></and><apply id="S1.Ex3.m2.1.1b.cmml" xref="S1.Ex3.m2.1.1"><eq id="S1.Ex3.m2.1.1.3.cmml" xref="S1.Ex3.m2.1.1.3"></eq><csymbol cd="latexml" id="S1.Ex3.m2.1.1.2.cmml" xref="S1.Ex3.m2.1.1.2">absent</csymbol><apply id="S1.Ex3.m2.1.1.4.cmml" xref="S1.Ex3.m2.1.1.4"><csymbol cd="ambiguous" id="S1.Ex3.m2.1.1.4.1.cmml" xref="S1.Ex3.m2.1.1.4">superscript</csymbol><ci id="S1.Ex3.m2.1.1.4.2.cmml" xref="S1.Ex3.m2.1.1.4.2">𝐝𝐎𝐕</ci><csymbol cd="latexml" id="S1.Ex3.m2.1.1.4.3.cmml" xref="S1.Ex3.m2.1.1.4.3">top</csymbol></apply></apply><apply id="S1.Ex3.m2.1.1c.cmml" xref="S1.Ex3.m2.1.1"><in id="S1.Ex3.m2.1.1.5.cmml" xref="S1.Ex3.m2.1.1.5"></in><share href="#S1.Ex3.m2.1.1.4.cmml" id="S1.Ex3.m2.1.1d.cmml" xref="S1.Ex3.m2.1.1"></share><apply id="S1.Ex3.m2.1.1.6.cmml" xref="S1.Ex3.m2.1.1.6"><csymbol cd="ambiguous" id="S1.Ex3.m2.1.1.6.1.cmml" xref="S1.Ex3.m2.1.1.6">superscript</csymbol><ci id="S1.Ex3.m2.1.1.6.2.cmml" xref="S1.Ex3.m2.1.1.6.2">ℝ</ci><apply id="S1.Ex3.m2.1.1.6.3.cmml" xref="S1.Ex3.m2.1.1.6.3"><times id="S1.Ex3.m2.1.1.6.3.1.cmml" xref="S1.Ex3.m2.1.1.6.3.1"></times><ci id="S1.Ex3.m2.1.1.6.3.2.cmml" xref="S1.Ex3.m2.1.1.6.3.2">𝑁</ci><ci id="S1.Ex3.m2.1.1.6.3.3.cmml" xref="S1.Ex3.m2.1.1.6.3.3">𝑁</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.Ex3.m2.1c">\displaystyle=\mathbf{dO}\mathbf{V}^{\top}\in\mathbb{R}^{N\times N}</annotation><annotation encoding="application/x-llamapun" id="S1.Ex3.m2.1d">= bold_dOV start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_N × italic_N end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div id="S1.SS2.p3" class="ltx_para">
<p id="S1.SS2.p3.10" class="ltx_p">Standard attention implementations materialize the matrices <math id="S1.SS2.p3.1.m1.1" class="ltx_Math" alttext="\mathbf{S}" display="inline"><semantics id="S1.SS2.p3.1.m1.1a"><mi id="S1.SS2.p3.1.m1.1.1" xref="S1.SS2.p3.1.m1.1.1.cmml">𝐒</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.1.m1.1b"><ci id="S1.SS2.p3.1.m1.1.1.cmml" xref="S1.SS2.p3.1.m1.1.1">𝐒</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.1.m1.1c">\mathbf{S}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.1.m1.1d">bold_S</annotation></semantics></math> and <math id="S1.SS2.p3.2.m2.1" class="ltx_Math" alttext="\mathbf{P}" display="inline"><semantics id="S1.SS2.p3.2.m2.1a"><mi id="S1.SS2.p3.2.m2.1.1" xref="S1.SS2.p3.2.m2.1.1.cmml">𝐏</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.2.m2.1b"><ci id="S1.SS2.p3.2.m2.1.1.cmml" xref="S1.SS2.p3.2.m2.1.1">𝐏</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.2.m2.1c">\mathbf{P}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.2.m2.1d">bold_P</annotation></semantics></math> to
HBM, which takes <math id="S1.SS2.p3.3.m3.1" class="ltx_Math" alttext="O(N^{2})" display="inline"><semantics id="S1.SS2.p3.3.m3.1a"><mrow id="S1.SS2.p3.3.m3.1.1" xref="S1.SS2.p3.3.m3.1.1.cmml"><mi id="S1.SS2.p3.3.m3.1.1.3" xref="S1.SS2.p3.3.m3.1.1.3.cmml">O</mi><mo id="S1.SS2.p3.3.m3.1.1.2" xref="S1.SS2.p3.3.m3.1.1.2.cmml">⁢</mo><mrow id="S1.SS2.p3.3.m3.1.1.1.1" xref="S1.SS2.p3.3.m3.1.1.1.1.1.cmml"><mo stretchy="false" id="S1.SS2.p3.3.m3.1.1.1.1.2" xref="S1.SS2.p3.3.m3.1.1.1.1.1.cmml">(</mo><msup id="S1.SS2.p3.3.m3.1.1.1.1.1" xref="S1.SS2.p3.3.m3.1.1.1.1.1.cmml"><mi id="S1.SS2.p3.3.m3.1.1.1.1.1.2" xref="S1.SS2.p3.3.m3.1.1.1.1.1.2.cmml">N</mi><mn id="S1.SS2.p3.3.m3.1.1.1.1.1.3" xref="S1.SS2.p3.3.m3.1.1.1.1.1.3.cmml">2</mn></msup><mo stretchy="false" id="S1.SS2.p3.3.m3.1.1.1.1.3" xref="S1.SS2.p3.3.m3.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.3.m3.1b"><apply id="S1.SS2.p3.3.m3.1.1.cmml" xref="S1.SS2.p3.3.m3.1.1"><times id="S1.SS2.p3.3.m3.1.1.2.cmml" xref="S1.SS2.p3.3.m3.1.1.2"></times><ci id="S1.SS2.p3.3.m3.1.1.3.cmml" xref="S1.SS2.p3.3.m3.1.1.3">𝑂</ci><apply id="S1.SS2.p3.3.m3.1.1.1.1.1.cmml" xref="S1.SS2.p3.3.m3.1.1.1.1"><csymbol cd="ambiguous" id="S1.SS2.p3.3.m3.1.1.1.1.1.1.cmml" xref="S1.SS2.p3.3.m3.1.1.1.1">superscript</csymbol><ci id="S1.SS2.p3.3.m3.1.1.1.1.1.2.cmml" xref="S1.SS2.p3.3.m3.1.1.1.1.1.2">𝑁</ci><cn type="integer" id="S1.SS2.p3.3.m3.1.1.1.1.1.3.cmml" xref="S1.SS2.p3.3.m3.1.1.1.1.1.3">2</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.3.m3.1c">O(N^{2})</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.3.m3.1d">italic_O ( italic_N start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT )</annotation></semantics></math> memory.
Often <math id="S1.SS2.p3.4.m4.1" class="ltx_Math" alttext="N\gg d" display="inline"><semantics id="S1.SS2.p3.4.m4.1a"><mrow id="S1.SS2.p3.4.m4.1.1" xref="S1.SS2.p3.4.m4.1.1.cmml"><mi id="S1.SS2.p3.4.m4.1.1.2" xref="S1.SS2.p3.4.m4.1.1.2.cmml">N</mi><mo id="S1.SS2.p3.4.m4.1.1.1" xref="S1.SS2.p3.4.m4.1.1.1.cmml">≫</mo><mi id="S1.SS2.p3.4.m4.1.1.3" xref="S1.SS2.p3.4.m4.1.1.3.cmml">d</mi></mrow><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.4.m4.1b"><apply id="S1.SS2.p3.4.m4.1.1.cmml" xref="S1.SS2.p3.4.m4.1.1"><csymbol cd="latexml" id="S1.SS2.p3.4.m4.1.1.1.cmml" xref="S1.SS2.p3.4.m4.1.1.1">much-greater-than</csymbol><ci id="S1.SS2.p3.4.m4.1.1.2.cmml" xref="S1.SS2.p3.4.m4.1.1.2">𝑁</ci><ci id="S1.SS2.p3.4.m4.1.1.3.cmml" xref="S1.SS2.p3.4.m4.1.1.3">𝑑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.4.m4.1c">N\gg d</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.4.m4.1d">italic_N ≫ italic_d</annotation></semantics></math> (typically <math id="S1.SS2.p3.5.m5.1" class="ltx_Math" alttext="N" display="inline"><semantics id="S1.SS2.p3.5.m5.1a"><mi id="S1.SS2.p3.5.m5.1.1" xref="S1.SS2.p3.5.m5.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.5.m5.1b"><ci id="S1.SS2.p3.5.m5.1.1.cmml" xref="S1.SS2.p3.5.m5.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.5.m5.1c">N</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.5.m5.1d">italic_N</annotation></semantics></math> is on the order of 1k–8k and d is around 64–128).
The standard attention implementation (1) calls the matrix multiply (GEMM)
subroutine to multiply <math id="S1.SS2.p3.6.m6.1" class="ltx_Math" alttext="\mathbf{S}=\mathbf{Q}\mathbf{K}^{\top}" display="inline"><semantics id="S1.SS2.p3.6.m6.1a"><mrow id="S1.SS2.p3.6.m6.1.1" xref="S1.SS2.p3.6.m6.1.1.cmml"><mi id="S1.SS2.p3.6.m6.1.1.2" xref="S1.SS2.p3.6.m6.1.1.2.cmml">𝐒</mi><mo id="S1.SS2.p3.6.m6.1.1.1" xref="S1.SS2.p3.6.m6.1.1.1.cmml">=</mo><msup id="S1.SS2.p3.6.m6.1.1.3" xref="S1.SS2.p3.6.m6.1.1.3.cmml"><mi id="S1.SS2.p3.6.m6.1.1.3.2" xref="S1.SS2.p3.6.m6.1.1.3.2.cmml">𝐐𝐊</mi><mo id="S1.SS2.p3.6.m6.1.1.3.3" xref="S1.SS2.p3.6.m6.1.1.3.3.cmml">⊤</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.6.m6.1b"><apply id="S1.SS2.p3.6.m6.1.1.cmml" xref="S1.SS2.p3.6.m6.1.1"><eq id="S1.SS2.p3.6.m6.1.1.1.cmml" xref="S1.SS2.p3.6.m6.1.1.1"></eq><ci id="S1.SS2.p3.6.m6.1.1.2.cmml" xref="S1.SS2.p3.6.m6.1.1.2">𝐒</ci><apply id="S1.SS2.p3.6.m6.1.1.3.cmml" xref="S1.SS2.p3.6.m6.1.1.3"><csymbol cd="ambiguous" id="S1.SS2.p3.6.m6.1.1.3.1.cmml" xref="S1.SS2.p3.6.m6.1.1.3">superscript</csymbol><ci id="S1.SS2.p3.6.m6.1.1.3.2.cmml" xref="S1.SS2.p3.6.m6.1.1.3.2">𝐐𝐊</ci><csymbol cd="latexml" id="S1.SS2.p3.6.m6.1.1.3.3.cmml" xref="S1.SS2.p3.6.m6.1.1.3.3">top</csymbol></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.6.m6.1c">\mathbf{S}=\mathbf{Q}\mathbf{K}^{\top}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.6.m6.1d">bold_S = bold_QK start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT</annotation></semantics></math>, writes the result to HBM, then (2) loads
<math id="S1.SS2.p3.7.m7.1" class="ltx_Math" alttext="\lx@sectionsign" display="inline"><semantics id="S1.SS2.p3.7.m7.1a"><mi mathvariant="normal" id="S1.SS2.p3.7.m7.1.1" xref="S1.SS2.p3.7.m7.1.1.cmml">§</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.7.m7.1b"><ci id="S1.SS2.p3.7.m7.1.1.cmml" xref="S1.SS2.p3.7.m7.1.1">§</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.7.m7.1c">\lx@sectionsign</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.7.m7.1d">§</annotation></semantics></math> from HBM to compute softmax and write the result <math id="S1.SS2.p3.8.m8.1" class="ltx_Math" alttext="\mathbf{P}" display="inline"><semantics id="S1.SS2.p3.8.m8.1a"><mi id="S1.SS2.p3.8.m8.1.1" xref="S1.SS2.p3.8.m8.1.1.cmml">𝐏</mi><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.8.m8.1b"><ci id="S1.SS2.p3.8.m8.1.1.cmml" xref="S1.SS2.p3.8.m8.1.1">𝐏</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.8.m8.1c">\mathbf{P}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.8.m8.1d">bold_P</annotation></semantics></math> to HBM, and finally
(3) calls matrix multiply to get <math id="S1.SS2.p3.9.m9.1" class="ltx_Math" alttext="\mathbf{O}=\mathbf{P}\mathbf{V}" display="inline"><semantics id="S1.SS2.p3.9.m9.1a"><mrow id="S1.SS2.p3.9.m9.1.1" xref="S1.SS2.p3.9.m9.1.1.cmml"><mi id="S1.SS2.p3.9.m9.1.1.2" xref="S1.SS2.p3.9.m9.1.1.2.cmml">𝐎</mi><mo id="S1.SS2.p3.9.m9.1.1.1" xref="S1.SS2.p3.9.m9.1.1.1.cmml">=</mo><mi id="S1.SS2.p3.9.m9.1.1.3" xref="S1.SS2.p3.9.m9.1.1.3.cmml">𝐏𝐕</mi></mrow><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.9.m9.1b"><apply id="S1.SS2.p3.9.m9.1.1.cmml" xref="S1.SS2.p3.9.m9.1.1"><eq id="S1.SS2.p3.9.m9.1.1.1.cmml" xref="S1.SS2.p3.9.m9.1.1.1"></eq><ci id="S1.SS2.p3.9.m9.1.1.2.cmml" xref="S1.SS2.p3.9.m9.1.1.2">𝐎</ci><ci id="S1.SS2.p3.9.m9.1.1.3.cmml" xref="S1.SS2.p3.9.m9.1.1.3">𝐏𝐕</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.9.m9.1c">\mathbf{O}=\mathbf{P}\mathbf{V}</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.9.m9.1d">bold_O = bold_PV</annotation></semantics></math>.
As most of the operations are bounded by memory bandwidth, the large number of
memory accesses translates to slow wall-clock time.
Moreover, the required memory is <math id="S1.SS2.p3.10.m10.1" class="ltx_Math" alttext="O(N^{2})" display="inline"><semantics id="S1.SS2.p3.10.m10.1a"><mrow id="S1.SS2.p3.10.m10.1.1" xref="S1.SS2.p3.10.m10.1.1.cmml"><mi id="S1.SS2.p3.10.m10.1.1.3" xref="S1.SS2.p3.10.m10.1.1.3.cmml">O</mi><mo id="S1.SS2.p3.10.m10.1.1.2" xref="S1.SS2.p3.10.m10.1.1.2.cmml">⁢</mo><mrow id="S1.SS2.p3.10.m10.1.1.1.1" xref="S1.SS2.p3.10.m10.1.1.1.1.1.cmml"><mo stretchy="false" id="S1.SS2.p3.10.m10.1.1.1.1.2" xref="S1.SS2.p3.10.m10.1.1.1.1.1.cmml">(</mo><msup id="S1.SS2.p3.10.m10.1.1.1.1.1" xref="S1.SS2.p3.10.m10.1.1.1.1.1.cmml"><mi id="S1.SS2.p3.10.m10.1.1.1.1.1.2" xref="S1.SS2.p3.10.m10.1.1.1.1.1.2.cmml">N</mi><mn id="S1.SS2.p3.10.m10.1.1.1.1.1.3" xref="S1.SS2.p3.10.m10.1.1.1.1.1.3.cmml">2</mn></msup><mo stretchy="false" id="S1.SS2.p3.10.m10.1.1.1.1.3" xref="S1.SS2.p3.10.m10.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S1.SS2.p3.10.m10.1b"><apply id="S1.SS2.p3.10.m10.1.1.cmml" xref="S1.SS2.p3.10.m10.1.1"><times id="S1.SS2.p3.10.m10.1.1.2.cmml" xref="S1.SS2.p3.10.m10.1.1.2"></times><ci id="S1.SS2.p3.10.m10.1.1.3.cmml" xref="S1.SS2.p3.10.m10.1.1.3">𝑂</ci><apply id="S1.SS2.p3.10.m10.1.1.1.1.1.cmml" xref="S1.SS2.p3.10.m10.1.1.1.1"><csymbol cd="ambiguous" id="S1.SS2.p3.10.m10.1.1.1.1.1.1.cmml" xref="S1.SS2.p3.10.m10.1.1.1.1">superscript</csymbol><ci id="S1.SS2.p3.10.m10.1.1.1.1.1.2.cmml" xref="S1.SS2.p3.10.m10.1.1.1.1.1.2">𝑁</ci><cn type="integer" id="S1.SS2.p3.10.m10.1.1.1.1.1.3.cmml" xref="S1.SS2.p3.10.m10.1.1.1.1.1.3">2</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.SS2.p3.10.m10.1c">O(N^{2})</annotation><annotation encoding="application/x-llamapun" id="S1.SS2.p3.10.m10.1d">italic_O ( italic_N start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT )</annotation></semantics></math> due to having to store</p>
</div>
</section>
<section id="S1.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">1.3 </span><span id="S1.SS3.1.1" class="ltx_text ltx_font_smallcaps">FlashAttention</span>
</h3>

<div id="S1.SS3.p1" class="ltx_para">
<p id="S1.SS3.p1.1" class="ltx_p">To speed up attention</p>
</div>
</section>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Thu Jul 20 01:37:45 2023 by <a href="http://dlmf.nist.gov/LaTeXML/" class="ltx_LaTeXML_logo"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span style="font-size:70%;position:relative; bottom:2.2pt;">A</span>T<span style="position:relative; bottom:-0.4ex;">E</span></span><span class="ltx_font_smallcaps">xml</span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="[LOGO]"></a>
</div></footer>
</div>
</body>
</html>
